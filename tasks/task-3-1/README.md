# Автоматизация поставки

## Задание 3.1. Контейнеризация микросервисов

> - Создайте Dockerfile для каждого микросервиса
> - Создайте Helm чарты.
> - Соберите Docker-образы. 
> - Загрузите образы в хранилище артефактов.  
> - Запустите сервисы с помощью Helm. 
> - Протестируйте работу сервисов. 

Это было сделано в [Задании 2.2](../task-2-2/README.md)

## Задание 3.2. Настройка CI/CD-пайплайнов c помощью GitHub Actions

> - Создайте Helm чарты для каждого микросервиса
> - Создайте CI/CD-пайплайн для каждого микросервиса
> - Настройте триггеры для запуска пайплайнов
> - Проверьте работу пайплайнов:

- В реальных проектах используем Gitlab CI, потому сильно углубляться в Github Actions пока нет практического интераса
- Пример CI/CD сделал для сервиса `sh-device-core`
- В [Github ci.yaml](../../.github/workflows/ci.yaml) добавлен job `test` запускающий тесты 
- В реальном проекте в этой же джобе может быть запуск статических анализаторов кода
- Если тесты прошли то дальше запускается джоба `build` сборки docker образа 
- После сборки образ пушится в Registry (в данном случае сам github),  в реальном проекте 
это может быть свой Registry, в котором хранятся и другие образы чтобы их не грузить каждый раз
- После сборки образа запускается `deploy`,  
на этом шаге в реальном проекте в `values.yaml` пробрасываются env переменные из окружения/секретов (в зависимости от договоренностей)
Helm стартует редеплой сервиса в Кубернетис 
- Docker контейнер запускается в Kubernetes с этими env-переменными, обычно через health пробы проверяется его готовность 
чтобы включить в трафик и убить прошлый под.
- На последнем шаге могут быть какие-то джобы уведомления о успешном деплое

